<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ★★★ 新しいタイトルとフォント ★★★ -->
    <title>POWER SCAN</title>
    <!-- Tailwind CDN (temporary restore to recover layout) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- SCAUTER風フォントを読み込み -->
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@900&display=swap" rel="stylesheet">
    <!-- custom fonts -->
    <!-- MediaPipe Pose CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1675469242/pose.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.5.1675469242/drawing_utils.js"></script>
    <!-- MediaPipe Camera Utils -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body class="bg-gray-900 text-white font-tech-mono antialiased flex items-center justify-center min-h-screen">
    <!-- 効果音（sfx/ 配下に整理。未移動でも後述JSで自動フォールバックします） -->
    <audio id="se-button" src="sfx/button.mp3" preload="auto"></audio>
    <audio id="se-roulette" src="sfx/roulette.mp3" preload="auto"></audio>
    <audio id="se-roulette2" src="sfx/roulette2.mp3" preload="auto"></audio>
    <!-- BGM -->
    <audio id="bgm-player" preload="none" loop></audio>
    
    <div class="container mx-auto p-4 max-w-5xl w-full">
        <!-- ... スタート画面、説明画面、性別選択画面は変更なし ... -->
        <div id="screen-title" class="screen text-center space-y-12">
            <h1 id="main-title" class="text-5xl md:text-7xl font-black tracking-tighter font-orbitron">POWER SCAN</h1>
            <div class="flex flex-col md:flex-row gap-6 justify-center">
                <button id="btn-goto-instructions" class="btn">スタート</button>
                <button id="btn-goto-ranking" class="btn btn-secondary">ランキング</button>
                <button id="btn-goto-2pmeasure" class="btn btn-accent">バトル</button>
            </div>

            <!-- BGM セレクタ（任意） -->
            <div class="mt-6 flex items-center justify-center gap-3 text-sm text-gray-300">
                <label for="bgm-select">BGM:</label>
                <select id="bgm-select" class="bg-gray-800 border border-gray-600 rounded px-2 py-1">
                    <option value="">なし</option>
                </select>
                <button id="bgm-play" class="btn btn-secondary">▶</button>
                <button id="bgm-stop" class="btn btn-secondary">⏹</button>
            </div>
        </div>


        <!-- ===== 2人測定バトル画面 ===== -->
        <div id="screen-2pmeasure" class="screen hidden card space-y-6">
            <h2 class="text-3xl font-bold text-center font-orbitron">2にん そくてい バトル</h2>
            <div id="2pmeasure-stage" class="text-center text-xl text-cyan-300">1にんめ すたーと</div>
            <div class="flex gap-4 justify-center pt-4">
                <button id="btn-2pmeasure-start" class="btn">すたーと</button>
                <button id="btn-2pmeasure-next" class="btn btn-accent hidden">2にんめへ</button>
                <button id="btn-2pmeasure-battle" class="btn btn-accent hidden">たいせん！</button>
                <button id="btn-2pmeasure-exit" class="btn btn-secondary">やめる</button>
            </div>
        </div>

        <!-- ===== バトル結果画面 ===== -->
        <div id="screen-battle-result" class="screen hidden card space-y-6">
            <h2 class="text-3xl font-bold text-center font-orbitron">たいせん けっか</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-center">
                <div class="p-4 bg-gray-800 rounded">
                    <div class="text-gray-400 text-sm">PLAYER 1</div>
                    <div id="battle-p1-name" class="text-2xl font-orbitron">PLAYER1</div>
                    <div id="battle-p1-score" class="text-3xl text-yellow-300 font-mono">0</div>
                </div>
                <div class="p-4 bg-gray-800 rounded">
                    <div class="text-gray-400 text-sm">PLAYER 2</div>
                    <div id="battle-p2-name" class="text-2xl font-orbitron">PLAYER2</div>
                    <div id="battle-p2-score" class="text-3xl text-yellow-300 font-mono">0</div>
                </div>
            </div>
            <div id="battle-winner-text" class="text-center text-2xl text-cyan-300 font-orbitron">けっか を ひょうじ</div>
            <div class="flex gap-4 justify-center pt-2">
                <button id="btn-battle-rematch" class="btn">もう いっかい</button>
                <button id="btn-battle-back" class="btn btn-secondary">たいとるへ</button>
            </div>
        </div>
        <!-- 3種バトル画面は削除 -->
    <div id="screen-instructions" class="screen hidden card space-y-6"><h2 class="text-3xl font-bold text-center font-orbitron">experience</h2><div class="text-left space-y-4 text-gray-300 font-sans"><p>このシステムは、Webカメラに映ったあなたの姿から、秘められた戦闘能力指数「POWER SCAN」をリアルタイムに算出します。</p><ul class="list-disc list-inside space-y-2 pl-4"><li><strong>ポーズ:</strong> 体を大きく見せたり、構えを低くするとスコアが上がります。</li><li><strong>アクション:</strong> 素早い動きを繰り出すと、<strong class="text-white">アクションボーナス</strong>が加算されます！</li></ul><p>最高のポーズとアクションで、ハイスコアを目指してください！</p></div><div class="flex gap-4 justify-center pt-4"><button id="btn-back-to-title-1" class="btn btn-secondary">もどる</button><button id="btn-goto-gender" class="btn">つぎへ</button></div></div>
        <div id="screen-gender" class="screen hidden card space-y-6"><h2 class="text-3xl font-bold text-center font-orbitron">あなたのタイプを選択</h2><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><button class="gender-btn card text-center p-8 hover:bg-indigo-800 transition-colors duration-200" data-gender="male"><span class="text-6xl">🚹</span><p class="text-2xl font-bold mt-4 font-sans">男性</p></button><button class="gender-btn card text-center p-8 hover:bg-pink-800 transition-colors duration-200" data-gender="female"><span class="text-6xl">🚺</span><p class="text-2xl font-bold mt-4 font-sans">女性</p></button></div><div class="flex gap-4 justify-center pt-4"><button id="btn-back-to-instructions" class="btn btn-secondary">戻る</button></div></div>
        
        <!-- ===== 測定画面 (SCAUTERデザインに刷新) ===== -->
        <div id="screen-measurement" class="screen hidden">
            <div class="scouter-container">
                <!-- 映像とランドマーク描画用のCanvas -->
                <div class="video-wrapper">
                    <video id="input-video" autoplay playsinline></video>
                    <canvas id="output-canvas"></canvas>
                </div>

                <!-- HUDオーバーレイ -->
                <div class="hud-overlay">
                    <div class="hud-top-bar">
                        <div class="status-box">
                            <p>SYSTEM STATUS: <span id="socket-status" class="text-yellow-400">CONNECTING...</span></p>
                            <p>TARGET: <span class="text-white">LIVE ANALYSIS</span></p>
                        </div>
                    </div>

                    <div id="result-display" class="hud-main-readout">
                        <h2 class="readout-label">POWER SCAN</h2>
                        <p id="total-power" class="readout-value">0</p>
                    </div>

                    <div class="hud-sub-readouts">
                        <p>しんちょう: <span id="stat-height">0</span></p>
                        <p>リーチ: <span id="stat-reach">0</span></p>
                        <p>かたはば: <span id="stat-shoulder">0</span></p>
                        <p>ひょうじょう: <span id="stat-expression">0</span></p>
                        <p>しせい: <span id="stat-pose">0</span></p>
                        <hr class="my-2 border-green-500 opacity-30">
                        <p>BASE: <span id="base-power">0</span></p>
                        <p>POSE: <span id="pose-bonus">0</span></p>
                        <p>EXPR: <span id="expression-bonus">0</span></p>
                        <p>ACTION: <span id="speed-bonus">0</span></p>
                    </div>
                    
                    <div class="hud-bottom-bar">
                        <div class="hud-grid-lines"></div>
                        <button id="btn-start-measure" class="hud-button">START</button>
                        <button id="btn-back-to-title-2" class="hud-button hud-exit">EXIT</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ... ランキング画面は変更なし ... -->

        <!-- ===== 名前入力モーダル ===== -->
        <div id="name-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-50 hidden">
            <div class="card max-w-xs w-full text-center p-8 relative">
                <h2 class="text-2xl font-orbitron mb-4">NAME ENTRY</h2>
                <input id="input-player-name" type="text" maxlength="12" class="w-full p-2 rounded bg-gray-900 text-green-400 border-2 border-green-400 text-xl font-mono mb-4 focus:outline-none focus:ring-2 focus:ring-cyan-400" placeholder="YOUR NAME" autocomplete="off">
                <img id="save-preview" src="" alt="preview" style="display:block;margin:10px auto 0 auto;width:160px;height:120px;object-fit:cover;border-radius:8px;" />
                <div class="flex gap-4 justify-center">
                    <button id="btn-name-ok" class="btn">OK</button>
                    <button id="btn-name-cancel" class="btn btn-secondary">CANCEL</button>
                </div>
            </div>
        </div>
    <div id="screen-ranking" class="screen hidden card space-y-6"><h2 class="text-3xl font-bold text-center font-orbitron">POWER SCAN ランキング</h2><div id="ranking-list" class="space-y-3"></div><div class="flex gap-4 justify-center pt-4"><button id="btn-back-to-title-3" class="btn btn-secondary">もどる</button></div></div>

    </div>
    
    <script src="script.js" type="module" defer></script>
</body>
</html>