<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ファビコンエラー解決 -->
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAA">
    <!-- ★★★ 新しいタイトルとフォント ★★★ -->
    <title>スカウター</title>
    <!-- Tailwind CSS CDN (本番用設定) -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'tech-mono': ['Share Tech Mono', 'monospace'],
                        'orbitron': ['Orbitron', 'monospace'],
                        'fzgonta': ['FZGontaKana', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- SCAUTER風フォントを読み込み -->
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@900&display=swap" rel="stylesheet">
    <!-- custom fonts -->
    <!-- MediaPipe Pose CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1675469242/pose.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.5.1675469242/drawing_utils.js"></script>
    <!-- MediaPipe Camera Utils -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body class="bg-gray-900 text-white font-tech-mono antialiased flex items-center justify-center min-h-screen">
    <!-- 効果音 -->
    <audio id="se-button" preload="none">
        <source src="button.mp3" type="audio/mpeg">
    </audio>
    <audio id="se-roulette" preload="none">
        <source src="roulette.mp3" type="audio/mpeg">
    </audio>
    <audio id="se-roulette2" preload="none">
        <source src="roulette2.mp3" type="audio/mpeg">
    </audio>
    
    <div class="container mx-auto p-4 max-w-5xl w-full">
        <!-- ===== 三種バトル画面 ===== -->
        <div id="screen-three-events-battle" class="screen hidden card space-y-6">
            <h2 class="text-3xl font-bold text-center font-orbitron">三種バトル</h2>
            <div id="three-events-status" class="text-center text-lg text-cyan-300">第1種目：P1から測定スタート</div>
            <div class="flex flex-col md:flex-row gap-6 justify-center items-center">
                <div class="w-full md:w-1/2">
                    <div class="font-bold">プレイヤー1</div>
                    <div id="three-p1-power" class="text-2xl text-green-400">戦闘力: 0</div>
                </div>
                <div class="w-full md:w-1/2">
                    <div class="font-bold">プレイヤー2</div>
                    <div id="three-p2-power" class="text-2xl text-yellow-300">戦闘力: 0</div>
                </div>
            </div>
            <div class="flex gap-4 justify-center pt-4">
                <button id="btn-three-start" class="btn">第1種目開始</button>
            </div>
            <div id="three-events-result" class="text-center text-xl font-bold mt-4"></div>
        </div>
        <!-- ===== バトル説明画面 ===== -->
        <div id="screen-battle-info" class="screen hidden card space-y-6">
            <h2 class="text-3xl font-bold text-center font-orbitron">バトルモード説明</h2>
            <div class="text-left space-y-4 text-gray-300 font-sans">
                <p>2人で交互に測定し、三種バトルで戦闘力を競います。</p>
                <ul class="list-disc list-inside space-y-2 pl-4">
                    <li>1. プレイヤー1の性別選択→測定→名前入力</li>
                    <li>2. プレイヤー2の性別選択→測定→名前入力</li>
                    <li>3. 三種バトル（3回勝負、毎回負けた方の戦闘力が減少）</li>
                    <li>4. 最終戦闘力で勝敗決定！</li>
                </ul>
                <p>カメラの前で大きくポーズを決めて、最高の戦闘力を目指そう！</p>
            </div>
            <div class="flex gap-4 justify-center pt-4">
                <button id="btn-battle-info-next" class="btn">バトル開始</button>
                <button id="btn-battle-info-cancel" class="btn btn-secondary">やめる</button>
            </div>
        </div>
        <!-- ... スタート画面、説明画面、性別選択画面は変更なし ... -->
        <div id="screen-title" class="screen text-center space-y-12">
            <h1 id="main-title" class="text-5xl md:text-7xl font-black tracking-tighter">BATTLE INDEX</h1>
            <div class="flex flex-col md:flex-row gap-6 justify-center">
                <button id="btn-goto-instructions" class="btn">スキャン</button>
                <button id="btn-goto-ranking" class="btn btn-secondary">ランキング</button>
                <button id="btn-goto-2pmeasure" class="btn btn-accent">バトル</button>
                <button id="btn-goto-battle-info" class="btn btn-warning">バトルモード</button>
            </div>
        </div>


        <!-- ===== 2人測定バトル画面 ===== -->
        <div id="screen-2pmeasure" class="screen hidden card space-y-6">
            <h2 class="text-3xl font-bold text-center font-orbitron">2人測定バトル</h2>
            <div id="2pmeasure-stage" class="text-center text-xl text-cyan-300">1人目の測定を開始してください</div>
            <div class="flex gap-4 justify-center pt-4">
                <button id="btn-2pmeasure-start" class="btn">測定スタート</button>
                <button id="btn-2pmeasure-next" class="btn btn-accent hidden">2人目へ</button>
                <button id="btn-2pmeasure-battle" class="btn btn-accent hidden">対戦！</button>
                <button id="btn-2pmeasure-exit" class="btn btn-secondary">やめる</button>
            </div>
        </div>
        <!-- 3種バトル画面は削除 -->
        <div id="screen-instructions" class="screen hidden card space-y-6"><h2 class="text-3xl font-bold text-center font-orbitron">experience</h2><div class="text-left space-y-4 text-gray-300 font-sans"><p>このシステムは、Webカメラに映ったあなたの姿から、秘められた戦闘能力指数「BATTLE INDEX」をリアルタイムに算出します。</p><ul class="list-disc list-inside space-y-2 pl-4"><li><strong>ポーズ:</strong> 体を大きく見せたり、構えを低くするとスコアが上がります。</li><li><strong>アクション:</strong> 素早い動きを繰り出すと、<strong class="text-white">アクションボーナス</strong>が加算されます！</li></ul><p>最高のポーズとアクションで、ハイスコアを目指してください！</p></div><div class="flex gap-4 justify-center pt-4"><button id="btn-back-to-title-1" class="btn btn-secondary">もどる</button><button id="btn-goto-gender" class="btn">つぎへ</button></div></div>
        <div id="screen-gender" class="screen hidden card space-y-6"><h2 class="text-3xl font-bold text-center font-orbitron">あなたのタイプを選択</h2><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><button class="gender-btn card text-center p-8 hover:bg-indigo-800 transition-colors duration-200" data-gender="male"><span class="text-6xl">🚹</span><p class="text-2xl font-bold mt-4 font-sans">男性</p></button><button class="gender-btn card text-center p-8 hover:bg-pink-800 transition-colors duration-200" data-gender="female"><span class="text-6xl">🚺</span><p class="text-2xl font-bold mt-4 font-sans">女性</p></button></div><div class="flex gap-4 justify-center pt-4"><button id="btn-back-to-instructions" class="btn btn-secondary">戻る</button></div></div>
        
        <!-- ===== 測定画面 (SCAUTERデザインに刷新) ===== -->
        <div id="screen-measurement" class="screen hidden">
            <div class="scouter-container">
                <!-- 映像とランドマーク描画用のCanvas -->
                <div class="video-wrapper">
                    <video id="input-video" autoplay playsinline></video>
                    <canvas id="output-canvas"></canvas>
                </div>

                <!-- HUDオーバーレイ -->
                <div class="hud-overlay">
                    <div class="hud-top-bar">
                        <div class="status-box">
                            <p>SYSTEM STATUS: <span id="socket-status" class="text-yellow-400">CONNECTING...</span></p>
                            <p>TARGET: <span class="text-white">LIVE ANALYSIS</span></p>
                        </div>
                    </div>

                    <div id="result-display" class="hud-main-readout">
                        <h2 class="readout-label">BATTLE INDEX</h2>
                        <p id="total-power" class="readout-value">0</p>
                    </div>

                    <div class="hud-sub-readouts">
                        <p>身長: <span id="stat-height">0</span></p>
                        <p>リーチ: <span id="stat-reach">0</span></p>
                        <p>肩幅: <span id="stat-shoulder">0</span></p>
                        <p>表情: <span id="stat-expression">0</span></p>
                        <p>姿勢: <span id="stat-pose">0</span></p>
                        <hr class="my-2 border-green-500 opacity-30">
                        <p>BASE: <span id="base-power">0</span></p>
                        <p>POSE: <span id="pose-bonus">0</span></p>
                        <p>EXPR: <span id="expression-bonus">0</span></p>
                        <p>ACTION: <span id="speed-bonus">0</span></p>
                    </div>
                    
                    <div class="hud-bottom-bar">
                        <div class="hud-grid-lines"></div>
                        <button id="btn-start-measure" class="hud-button">START</button>
                        <button id="btn-back-to-title-2" class="hud-button" style="left:140px;">EXIT</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ... ランキング画面は変更なし ... -->

        <!-- ===== 名前入力モーダル ===== -->
        <div id="name-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-50 hidden">
            <div class="card max-w-xs w-full text-center p-8 relative">
                <h2 class="text-2xl font-orbitron mb-4">NAME ENTRY</h2>
                <input id="input-player-name" type="text" maxlength="12" class="w-full p-2 rounded bg-gray-900 text-green-400 border-2 border-green-400 text-xl font-mono mb-4 focus:outline-none focus:ring-2 focus:ring-cyan-400" placeholder="YOUR NAME" autocomplete="off">
                <img id="save-preview" src="" alt="preview" style="display:block;margin:10px auto 0 auto;width:160px;height:120px;object-fit:cover;border-radius:8px;" />
                <div class="flex gap-4 justify-center">
                    <button id="btn-name-ok" class="btn">OK</button>
                    <button id="btn-name-cancel" class="btn btn-secondary">CANCEL</button>
                </div>
            </div>
        </div>
        <div id="screen-ranking" class="screen hidden card space-y-6"><h2 class="text-3xl font-bold text-center font-orbitron">BATTLE INDEX ランキング</h2><div id="ranking-list" class="space-y-3"></div><div class="flex gap-4 justify-center pt-4"><button id="btn-back-to-title-3" class="btn btn-secondary">戻る</button></div></div>

    </div>
    
    <script src="script.js" type="module" defer></script>
</body>
</html>